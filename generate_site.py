#!/usr/bin/env python3
"""ç”Ÿæˆç½‘ç«™é™æ€æ–‡ä»¶"""

import json
import shutil
from datetime import datetime
from pathlib import Path

# è¯»å–æœ€æ–°æ•°æ®
files = sorted(Path('data').glob('test_*.json'))
if not files:
    print('âŒ æ— æ•°æ®æ–‡ä»¶')
    exit(1)

with open(files[-1]) as f:
    data = json.load(f)

# åˆ›å»º site ç›®å½•
Path('site').mkdir(exist_ok=True)

# ç”Ÿæˆ index.html
html_content = f'''<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>CEX Intelligence Report</title>
    <style>
        body {{ font-family: -apple-system, sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; background: #f5f5f5; }}
        h1 {{ color: #333; border-bottom: 2px solid #ddd; padding-bottom: 10px; }}
        .timestamp {{ color: #666; font-size: 14px; }}
        .status {{ padding: 15px 20px; border-radius: 8px; margin: 20px 0; font-weight: bold; }}
        .ok {{ background: #d4edda; color: #155724; }}
        .alert {{ background: #f8d7da; color: #721c24; }}
        .exchange {{ padding: 15px; border: 1px solid #ddd; border-radius: 8px; margin: 10px 0; background: white; }}
        .alert-level {{ font-size: 12px; padding: 2px 8px; border-radius: 4px; margin-left: 10px; }}
        .none {{ background: #d4edda; }}
        .low {{ background: #fff3cd; }}
        .medium {{ background: #ffe0b2; }}
        .high {{ background: #ffccbc; }}
        .critical {{ background: #ff8a80; color: white; }}
    </style>
</head>
<body>
    <h1>ğŸ¯ CEX æƒ…æŠ¥ç›‘æ§æŠ¥å‘Š</h1>
    <p class="timestamp">â° ç”Ÿæˆæ—¶é—´: {data.get('timestamp', 'N/A')}</p>
    <p class="timestamp">ğŸ¤– æ¨¡å‹: {data.get('model', 'N/A')}</p>
    
    <div class="status {'alert' if data.get('key_alerts') else 'ok'}">
        {'ğŸš¨ å‘ç° ' + str(len(data.get('key_alerts', []))) + ' é¡¹è­¦æŠ¥' if data.get('key_alerts') else 'âœ… ä»Šæ—¥ç›‘æ§æ­£å¸¸ï¼Œæœªå‘ç°é‡å¤§é£é™©'}
    </div>
    
    <h2>ğŸ“Š ç›‘æ§äº¤æ˜“æ‰€ ({len(data.get('exchanges', []))} ä¸ª)</h2>
    {''.join(f'<div class="exchange"><strong>{e.get("exchange")}</strong><span class="alert-level {e.get("alert_level", "none")}">{e.get("alert_level", "none").upper()}</span><br><small>ğŸ¦ Xå¸–å­: {len(e.get("x_posts", []))} | ğŸ“° æ–°é—»: {len(e.get("web_articles", []))}</small></div>' for e in data.get('exchanges', []))}
    
    <p style="margin-top: 40px; color: #999; font-size: 12px; text-align: center;">
        ğŸ”„ è‡ªåŠ¨ generated by CEX Intelligence Bot | æ¯æ—¥ 09:00 æ›´æ–°
    </p>
</body>
</html>'''

with open('site/index.html', 'w', encoding='utf-8') as f:
    f.write(html_content)

# å¤åˆ¶ JSON æ•°æ®
shutil.copy(files[-1], 'site/data.json')

print('âœ… ç½‘ç«™æ–‡ä»¶å·²ç”Ÿæˆ:')
print('  - site/index.html')
print('  - site/data.json')
